---
sidebar: auto
---

# 前言

## HTTP 是什么？ 
简单的说 HTTP 是超文本传输协议。所谓**超文本**，就是"超越了普通文本的文本"，他是文字、图片、音频和视频等的混合体，最关键的是含有超链接。我们熟知的 HTML 就是一种"超文本"。传输就是计算机之间传输数据的约定和规范。协议是指使用计算机能够理解的语言确立的的一种计算机之间交流通信的规范，以及相关的各种控制和错误的处理方式。
总结来说，`HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。`


## 与 HTTP 有关的各种概念

### 1. 浏览器
浏览器的正式名字叫 `Web Browser`，顾名思义，就是检索、查看互联网上资源的应用程序。`Web` 实际上指的就是 `World Wide Web`，也就是万维网。

浏览器本质上是 `HTTP` 协议中的请求方，使用 `HTTP` 协议获取网络上的各种资源。

在 `HTTP` 协议里，浏览器的角色被称为 `User Agent` 即 "用户代理"，意思是作为访问者的 "代理" 来发起 `HTTP` 请求。我们通常也简单的称之为 "客户端"。

### 2. Web 服务器
浏览器作为 `HTTP` 协议的请求方，服务器作为协议的响应方。它是 HTTP 协议里响应请求的主体，通常也把控着绝大多数的网络资源，在网络世界里处于强势地位。

### 3. CDN
浏览器和服务器是 `HTTP` 协议的两个端点，浏览器通常不会直接连接到服务器，中间会经过 "重重关卡"，CDN 就是其中一个重要的角色。

CDN，全称是“Content Delivery Network”（内容分发网络）。它应用了 HTTP 协议里的缓存和代理技术，代替源站响应客户端的请求。

那么，为什么要使用 CDN 呢？

简单来说，CDN 可以缓存服务器的数据，让浏览器的请求不用 "千里迢迢" 地到达源站服务器，直接在 "半路" 就可以获取响应。CDN 可以找到离浏览器最近的节点，直接返回缓存数据，大幅度缩短来响应时间。在网页开发中，我们经常将一些 JS 文件、图片等资源上传到 CDN 中，来优化网站的响应速度。

### 4. HTML
HTML 是 HTTP 协议传输的主要内容之一，它描述了超文本页面，用各种“标签”定义文字、图片等资源和排版布局，最终由浏览器“渲染”出可视化页面。

### 5. WebService
WebService 是一种 Web 应用程序，WebService是一种跨编程语言和跨操作系统平台的远程调用技术。

Web Service 是一种由 W3C 定义的应用服务开发规范，使用 client-server 主从架构，通常使用 WSDL 定义服务接口，使用 HTTP 协议传输 XML 或 SOAP 消息，它是一个基于 Web（HTTP）的服务架构技术，既可以运行在内网，也可以在适当保护后运行在外网。

### 6. WAF
WAF 是一种 Web 应用程序防护系统（Web Application Firewall，简称 WAF），它是一种通过执行一系列针对HTTP / HTTPS的安全策略来专门为Web应用提供保护的一款产品，它是应用层面的防火墙，专门检测 HTTP 流量，是防护 Web 应用的安全技术。 WAF 通常位于 Web 服务器之前，可以阻止如 SQL 注入、跨站脚本等攻击。

## 与 HTTP 相关的各种协议

### 1. TCP/IP 协议
TCP/IP 协议是一系列网络通信协议的统称，其中最核心的两个协议是 **TCP** 和 **IP**，其他的还有 UDP、ICMP、ARP 等等，共同构成了一个复杂但有层次的协议栈。

这个协议栈有四层，从上至下依次是 "应用层"、"传输层"、"网络层"、"链接层"，TCP 和 IP 分别属于 "传输层" 和 "网络层"。接下来，我们先详细了解一下 TCP/IP 网络分层模型。

#### 1.1 应用层
应用层决定了向用户提供应用服务时通信的活动。

TCP/IP 协议族内预存了各类通用的应用服务。比如，FTP 和 DNS。HTTP 协议也处于该层。

#### 1.2 传输层
传输层对上层应用层，提供处于网络连接中两台计算机之间的数据传输。它的职责是保证数据在 IP 地址标记的两点之间 "可靠" 的传输。

传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议）和 UDP（User Data Protocol，用户数据报协议）

`TCP 是一个有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢失不重复。而 UDP 则比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP 的数据是连续的“字节流”，有先后顺序，而 UDP 则是分散的小数据包，是顺序发，乱序收`

#### 1.3 网络层
网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数据单位。该层规定了通过怎样的路径到达对方的计算机，并把数据包传给对方。

#### 1.4 链接层
链接层用来处理连接网络的硬件部分。包括操作系统、硬件的设备驱动、光纤等物理可见部分。

#### TCP/IP 通信传输流

![](./images/TCP_IP.png)

利用 TCP/IP 协议进行网络通信时，会通过分层顺序与对方进行通信。发送端从应用层开始往下走，接收端从链接层开始往上走。

我们用 HTTP 举例来说明：

首先作为发送端的客户端在应用层发出一个带有数据的 HTTP 请求。

接着，在传输层，TCP 协议会将 HTTP 协议发送的数据看作一个数据包，并在数据包的前面加上 TCP 包的一部分信息。

接着，在网络层，IP 协议会将 TCP 协议要发送的数据看作一个数据包，同样在这个数据包的前面加上 IP 协议的部首。

接着，在链接层，对应的协议也会在 IP 数据包前面加上以太网的部首。

![](./images/case1.png)

在接收端，数据链接层会使用对应的协议找到物理层的数据，经过解码得到以太网的部首信息和对应的 IP 数据包。再将 IP 数据包传给上层的网络层。

接着，网络层经过解码得到 IP 协议的首部和对应的 TCP 数据包。再将 TCP 数据包传给上层的传输层。

接着，传输层经过解码得到 TCP 协议的首部和对应的 HTTP 数据包，再将数据包传给上层的应用层。

接着，应用层就就得到从目标设备传送过来的数据。

![](./images/case2.png)

### 2. DNS
在 TCP/IP 协议中使用 IP 地址来标识计算机，但数字形式的地址难以记忆，于是**域名系统**（Domain Name System）就出现来，用有意义的名字来作为 IP 地址的等价替代。

在 DNS 中， "域名"又称为 "主机名"，为了更好地标记不同国家或组织的主机，让名字更好记，所以被设计成了一个有层次的结构。

域名用 “.” 分隔成多个单词，级别从左到右逐级升高，最右边的被称为 “顶级域名”。对于顶级域名，可能你随口就能说出几个，例如表示商业公司的“com”、表示教育机构的“edu”，表示国家的 “cn”、“uk” 等。

但想要使用 TCP/IP 协议来通信仍然要使用 IP 地址，所以需要把域名做一个转换，“映射” 到它的真实 IP，这就是所谓的 “**域名解析**”。

### 3. URI/URL
要访问网络上的资源，光有 TCP/IP 和 DNS 还不够。因为，DNS 和 IP 地址只是标记了互联网上的主机，但主机上有很多文本、图片、页面，我们并不能知道具体要访问的资源。

所以就出现了 URI（Uniform Resource Identifier），中文名称是 **统一资源标识符**，使用它就能够唯一地标记互联网上资源。

URI 另一个更常用的表现形式是 URL（Uniform Resource Locator），**统一资源定位符**，也就是我们俗称的 “网址”，它实际上是 URI 的一个子集，不过因为这两者几乎是相同的，差异不大，所以通常不会做严格的区分。

URI 主要由三个基本的部分组成：
1. 协议名：即访问该资源应当使用的协议，常见的有 HTTP、HTTPS、FTP。
2. 主机名：即互联网上主机的标记，可以是域名或者 IP 地址。
3. 路径：即资源在主机上的位置，使用 "/" 分隔多级目录。

就拿 Nginx 网站来举例，看一下 URI 是什么样子的。
```
http://nginx.org/en/download.html
```
其中，http 就是协议名，nginx.org 就是主机名，/en/download.html 就是路径。


### 4. HTTPS
私钥  服务器通过私钥解密公钥加密过后的数据
公钥  放在互联网上，用来加密传输的数据


### Nginx

```shell
// 查看 nginx 安装目录
weheris nginx

// 启动 nginx
systemctl start nginx

// 停止 nginx
systemctl stop nginx

// 启动 nginx
systemctl reload nginx

// 强制重启 nginx
systemctl restart nginx

// 设置开机启动 nginx
systemctl enable nginx

// 查询 nginx 状态
systemctl status nginx

// 代理缓存       存放目录  是否创建二级文件夹   10m 缓存大小
proxy_cache_path cache levels=1:2 keys_zone=my_cache:10m
// 使用代理缓存的时候 往往需要和 response header  Vary 一起使用

server {
  listen    80;
  server_name test.com;
  
  location / {
    proxy_cache my_cache; // 使用代理缓存
    proxy_pass http://127.0.0.1:8888; // 表示所有的请求都代理到这个地方
    proxy_set_header Host $host;
  }
}

```
