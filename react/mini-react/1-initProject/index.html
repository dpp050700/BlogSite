<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>初始化项目 | 此间少年</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/BlogSite/icon.jpeg">
    <meta name="description" content="我的个人博客">
    
    <link rel="preload" href="/BlogSite/assets/css/0.styles.a8333bdb.css" as="style"><link rel="preload" href="/BlogSite/assets/js/app.93347ae9.js" as="script"><link rel="preload" href="/BlogSite/assets/js/2.1c2fd4e3.js" as="script"><link rel="preload" href="/BlogSite/assets/js/5.78d91289.js" as="script"><link rel="prefetch" href="/BlogSite/assets/js/10.de67b419.js"><link rel="prefetch" href="/BlogSite/assets/js/11.3fdda2b9.js"><link rel="prefetch" href="/BlogSite/assets/js/12.9b0e215f.js"><link rel="prefetch" href="/BlogSite/assets/js/13.d8c7d23a.js"><link rel="prefetch" href="/BlogSite/assets/js/14.8070651f.js"><link rel="prefetch" href="/BlogSite/assets/js/15.a6691e12.js"><link rel="prefetch" href="/BlogSite/assets/js/16.b1815631.js"><link rel="prefetch" href="/BlogSite/assets/js/17.8f49d4b1.js"><link rel="prefetch" href="/BlogSite/assets/js/18.4b6e7014.js"><link rel="prefetch" href="/BlogSite/assets/js/19.9cc899e6.js"><link rel="prefetch" href="/BlogSite/assets/js/20.9c258601.js"><link rel="prefetch" href="/BlogSite/assets/js/21.2b359636.js"><link rel="prefetch" href="/BlogSite/assets/js/22.5ad1554d.js"><link rel="prefetch" href="/BlogSite/assets/js/23.125badf3.js"><link rel="prefetch" href="/BlogSite/assets/js/24.3731cae6.js"><link rel="prefetch" href="/BlogSite/assets/js/25.86df1f33.js"><link rel="prefetch" href="/BlogSite/assets/js/26.5dbbfe9d.js"><link rel="prefetch" href="/BlogSite/assets/js/27.48079411.js"><link rel="prefetch" href="/BlogSite/assets/js/28.e76ed6c8.js"><link rel="prefetch" href="/BlogSite/assets/js/29.de1b2025.js"><link rel="prefetch" href="/BlogSite/assets/js/3.e2c05d27.js"><link rel="prefetch" href="/BlogSite/assets/js/30.3e54ad6e.js"><link rel="prefetch" href="/BlogSite/assets/js/31.ea116c0f.js"><link rel="prefetch" href="/BlogSite/assets/js/32.25f4b7c9.js"><link rel="prefetch" href="/BlogSite/assets/js/33.d92b5d0e.js"><link rel="prefetch" href="/BlogSite/assets/js/34.3082af57.js"><link rel="prefetch" href="/BlogSite/assets/js/35.5585f154.js"><link rel="prefetch" href="/BlogSite/assets/js/36.cfd988ee.js"><link rel="prefetch" href="/BlogSite/assets/js/37.e36e7272.js"><link rel="prefetch" href="/BlogSite/assets/js/38.65c86de2.js"><link rel="prefetch" href="/BlogSite/assets/js/39.0e5dac13.js"><link rel="prefetch" href="/BlogSite/assets/js/4.a148926e.js"><link rel="prefetch" href="/BlogSite/assets/js/40.bf033fb0.js"><link rel="prefetch" href="/BlogSite/assets/js/41.ae655f8c.js"><link rel="prefetch" href="/BlogSite/assets/js/42.74519c16.js"><link rel="prefetch" href="/BlogSite/assets/js/43.4ccf3a26.js"><link rel="prefetch" href="/BlogSite/assets/js/44.b95e8b96.js"><link rel="prefetch" href="/BlogSite/assets/js/45.8ab9f25b.js"><link rel="prefetch" href="/BlogSite/assets/js/46.f98ddc19.js"><link rel="prefetch" href="/BlogSite/assets/js/47.3a755fb7.js"><link rel="prefetch" href="/BlogSite/assets/js/48.bc0f5cb7.js"><link rel="prefetch" href="/BlogSite/assets/js/49.72d8b160.js"><link rel="prefetch" href="/BlogSite/assets/js/50.7f790bba.js"><link rel="prefetch" href="/BlogSite/assets/js/51.89d688e4.js"><link rel="prefetch" href="/BlogSite/assets/js/52.2842865d.js"><link rel="prefetch" href="/BlogSite/assets/js/53.7be1eb1d.js"><link rel="prefetch" href="/BlogSite/assets/js/54.f3c3384e.js"><link rel="prefetch" href="/BlogSite/assets/js/55.2bd1641e.js"><link rel="prefetch" href="/BlogSite/assets/js/56.f2771313.js"><link rel="prefetch" href="/BlogSite/assets/js/6.d54a6eb8.js"><link rel="prefetch" href="/BlogSite/assets/js/7.439e92a8.js"><link rel="prefetch" href="/BlogSite/assets/js/8.2ba067f6.js"><link rel="prefetch" href="/BlogSite/assets/js/9.f878b838.js">
    <link rel="stylesheet" href="/BlogSite/assets/css/0.styles.a8333bdb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/BlogSite/" class="home-link router-link-active"><!----> <span class="site-name">此间少年</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端三剑客" class="dropdown-title"><span class="title">前端三剑客</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端三剑客" class="mobile-dropdown-title"><span class="title">前端三剑客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/javascript/prototype/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/BlogSite/http/" class="nav-link">
  HTTP
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/vue/" class="nav-link">
  vue2.0
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/vueNext/" class="nav-link">
  vue3.0
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/react/analysis/" class="nav-link">
  React18
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="打包工具" class="dropdown-title"><span class="title">打包工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="打包工具" class="mobile-dropdown-title"><span class="title">打包工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/rollup/" class="nav-link">
  rollup
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/vite/" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试分享" class="dropdown-title"><span class="title">面试分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试分享" class="mobile-dropdown-title"><span class="title">面试分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/interviewQuestion/html/" class="nav-link">
  面试八股文
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/interviewCompany/company1/" class="nav-link">
  面试记录
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端三剑客" class="dropdown-title"><span class="title">前端三剑客</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端三剑客" class="mobile-dropdown-title"><span class="title">前端三剑客</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/html/" class="nav-link">
  HTML
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/javascript/prototype/" class="nav-link">
  JavaScript
</a></li></ul></div></div><div class="nav-item"><a href="/BlogSite/http/" class="nav-link">
  HTTP
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端框架" class="dropdown-title"><span class="title">前端框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端框架" class="mobile-dropdown-title"><span class="title">前端框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/vue/" class="nav-link">
  vue2.0
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/vueNext/" class="nav-link">
  vue3.0
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/react/analysis/" class="nav-link">
  React18
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="打包工具" class="dropdown-title"><span class="title">打包工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="打包工具" class="mobile-dropdown-title"><span class="title">打包工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/webpack/" class="nav-link">
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/rollup/" class="nav-link">
  rollup
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/vite/" class="nav-link">
  vite
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试分享" class="dropdown-title"><span class="title">面试分享</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试分享" class="mobile-dropdown-title"><span class="title">面试分享</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BlogSite/interviewQuestion/html/" class="nav-link">
  面试八股文
</a></li><li class="dropdown-item"><!----> <a href="/BlogSite/interviewCompany/company1/" class="nav-link">
  面试记录
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/BlogSite/react/analysis/" class="sidebar-link">React 原理分析</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/BlogSite/react/mini-react/" class="sidebar-heading clickable router-link-active open"><span>React 源码实现</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/BlogSite/react/mini-react/1-initProject/" aria-current="page" class="active sidebar-link">初始化项目</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="初始化项目"><a href="#初始化项目" class="header-anchor">#</a> 初始化项目</h1> <h2 id="基于-pnpm-搭建-monorepo-项目"><a href="#基于-pnpm-搭建-monorepo-项目" class="header-anchor">#</a> 基于 pnpm 搭建 monorepo 项目</h2> <ol><li>创建项目文件夹</li></ol> <p>首先，第一步我们先创建一个项目文件夹：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">mkdir</span> mini-react
<span class="token builtin class-name">cd</span> mini-react
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre></div><p>创建 <code>packages</code> 文件夹用来存放 <code>react</code> 源码相关的文件, 创建 <code>demo</code> 文件夹用来存放案例代码。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>mkdiir packages
mkdiir demos
</code></pre></div><p>创建 <code>pnpm-workspace.yaml</code> 文件，配置 workspace:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">packages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">'packages/*'</span>
</code></pre></div><ol start="2"><li>利用 <code>Vite</code> 运行 <code>demo</code></li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> init-react
<span class="token function">pnpm</span> <span class="token function">install</span> vite <span class="token parameter variable">-D</span> <span class="token parameter variable">-w</span>
<span class="token function">pnpm</span> <span class="token function">install</span> @vitejs/plugin-react <span class="token parameter variable">-D</span> <span class="token parameter variable">-w</span>
<span class="token function">pnpm</span> <span class="token function">install</span> typescript <span class="token parameter variable">-D</span> <span class="token parameter variable">-w</span>
</code></pre></div><p>在 <code>demos</code> 文件夹下创建 <code>vite.config.ts</code> 用来存放 <code>vite</code> 相关的配置，创建 <code>tsconfig.json</code> 用来存放 <code>typescript</code> 相关的配置</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>
<span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">'@vitejs/plugin-react'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">&quot;target&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;useDefineForClassFields&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;lib&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;DOM&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DOM.Iterable&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowJs&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;skipLibCheck&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;esModuleInterop&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token property">&quot;allowSyntheticDefaultImports&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;strict&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;forceConsistentCasingInFileNames&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;module&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ESNext&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;moduleResolution&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Node&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;resolveJsonModule&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;isolatedModules&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;noEmit&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">&quot;jsx&quot;</span><span class="token operator">:</span> <span class="token string">&quot;react-jsx&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;include&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在 <code>demos</code> 文件夹下创建 <code>v1</code> 文件夹，用来存放我们第一个 <code>demo</code></p> <p>在 v1 文件夹下创建 <code>index.html</code> 和 <code>main.tsx</code>, 内容分别为下：</p> <div class="language-html extra-class"><pre class="language-html"><code>// index.html
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Demo V1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>root<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/main.tsx<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token comment">// main.tsx</span>
<span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

root<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
</code></pre></div><p>安装 React 和 React-DOM</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">pnpm</span> <span class="token function">install</span> react react-dom <span class="token parameter variable">-D</span> <span class="token parameter variable">-w</span>
</code></pre></div><p>在 <code>package.json</code> 中配置 <code>demo:v1</code> 的启动命令：</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;demo:v1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;vite serve demos/v1 --config demos/vite.config.js --force&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>随后，我们可以在命令行输入如下命令：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> run demo:v1
</code></pre></div><p><img src="/BlogSite/assets/img/demo-start.330910c3.jpg" alt=""></p> <p>打开 <a href="http://127.0.0.1:5173/" target="_blank" rel="noopener noreferrer">http://127.0.0.1:5173/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 可以正常显示页面。</p> <p><img src="/BlogSite/assets/img/demo-page.162cda7d.jpg" alt=""></p> <p>至此，我们的 <code>demo</code> 就可以正常显示来。后续我们可以将 <code>react</code> 和 <code>react-dom</code> 的引用改为自己的源码目录，这样我们就可以进行调试了。</p> <ol start="3"><li>创建 React 包</li></ol> <p>在 <code>packages</code> 目录下创建 <code>react</code> 文件夹，并在 <code>react</code> 文件夹下执行 <code>npm init -y</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> packages
<span class="token function">mkdir</span> react
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre></div><p>在 <code>react</code> 目录下新建 <code>index.ts</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span>  <span class="token keyword">default</span>  <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>我们先把 <code>demo:v1</code> 下的 <code>main.tsx</code> 修改一下：</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">const</span> element <span class="token operator">=</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">hello world</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>接下来，需要在 <code>vite.config.ts</code> 中配置 <code>resolve.alias</code> 将 <code>react</code> 的引用改为 <code>packages/react</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...省略其他配置</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        find<span class="token operator">:</span> <span class="token string">'react'</span><span class="token punctuation">,</span>
        replacement<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../packages/react'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>此时，我们重新运行 <code>demo</code>，</p> <p><img src="/BlogSite/assets/img/1.14e77490.jpg" alt=""></p> <p>我们发现页面报错了，并且提示我们找不到 <code>react/jsx-dev-runtime</code> 的文件，</p> <p>那么，我们按照提示创建一下该文件：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> packages/react
<span class="token function">mkdir</span> jsx-dev-runtime
</code></pre></div><p>再次重新运行 <code>demo</code>:</p> <p><img src="/BlogSite/assets/img/2.432b2d9b.jpg" alt=""></p> <p>此时浏览器又报了另外一个错误，提示我们没有导出 <code>jsxDEV</code> 的方法，</p> <p>那么，我们在 <code>react/jsx-dev-runtime</code> 文件里创建该方法并导出，</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">jsxDEV</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'jsxDEV'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>此时浏览器没有抛出错误，且正常打印了 <code>jsxDEV</code>。那么，我们为什么要这样做呢？</p> <p>我们知道，浏览器是不认识 <code>tsx|jsx</code> 这种写法的，所以，我们需要将 <code>tsx|jsx</code> 进行一次转换，转换成浏览器可识别的语言。</p> <p>在 <code>vite.config.ts</code> 中，我们引入了 <code>@vitejs/plugin-react</code> 插件。其实 <code>@vitejs/plugin-react</code> 就是帮我们把写的 <code>tsx|jsx</code> 语法转换成浏览器可识别的语言。它的内部其实是通过 <code>@babel/plugin-transform-react-jsx</code> 这个<code>babel</code>插件来实现的。</p> <p>我们可以打开 <code>babel</code> 的<a href="https://www.babeljs.cn/" target="_blank" rel="noopener noreferrer">官网<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，点击上面的<strong>试一试</strong></p> <p>在左侧编辑器中写入我们的 <code>JSX</code> 语法，<code>OPTIONS</code> 选择 <code>Automatic</code>，右侧就是 <code>@babel/plugin-transform-react-jsx</code> 转换之后的代码。</p> <p><img src="/BlogSite/assets/img/3.2056cd8c.jpg" alt=""></p> <p>可以看出，我们写的 <code>jsx</code> 语法最终都会被转成一个 <code>jsx</code> 的方法。为什么不是 <code>jsxDEV</code> 呢？因为，我们这边通过 <code>babel</code> 转的是 <code>production</code> 环境，而在运行 <code>demo</code> 的时候是 <code>development</code>。</p> <p>我们可以添加 <code>@babel/plugin-transform-react-jsx-development</code> 这样一个插件，点击 <code>Add Plugin</code> 进行添加：</p> <p><img src="/BlogSite/assets/img/4.b8fb1c82.jpg" alt=""></p> <p>添加完成之后，可以看到 <code>jsx</code> 都转成了 <code>jsxDEV</code> 方法。</p> <ol start="4"><li>创建 React-Dom 包</li></ol> <p>在 <code>packages</code> 目录下创建 <code>react-dom</code> 文件夹，并在 <code>react-dom</code> 文件夹下执行 <code>npm init -y</code></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">cd</span> packages
<span class="token function">mkdir</span> react
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre></div><p>在 <code>react-dom</code> 目录下新建 <code>index.ts</code>：</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">export</span>  <span class="token keyword">default</span>  <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><p>我可以看一下 <code>demo</code> 中 <code>main.tsx</code> 中的代码，</p> <div class="language-tsx extra-class"><pre class="language-tsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-dom/client'</span>

<span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'root'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>可以看出 <code>react-dom/client</code> 导出了一个 <code>createRoot</code> 的方法，该方法接收一个参数，并返回一个 <code>render</code> 方法。</p> <p>那么，我们可以在 <code>react-dom</code> 下创建 <code>client.ts</code>、<code>src/client/ReactDOMRoot.ts</code> 文件，</p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">// src/client/ReactDOMRoot.ts</span>
<span class="token keyword">function</span> <span class="token function">ReactDOMRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

ReactDOMRoot<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'render'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token punctuation">(</span>ReactDOMRoot <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-ts extra-class"><pre class="language-ts"><code><span class="token comment">//client.ts</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> createRoot <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./src/client/ReactDOMRoot'</span>
</code></pre></div><p>同样的，我们需要在 <code>vite.config.ts</code> 中配置 <code>resolve.alias</code> 将 <code>react-dom</code> 的引用改为 <code>packages/react-dom</code></p> <div class="language-ts extra-class"><pre class="language-ts"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...省略其他配置</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        find<span class="token operator">:</span> <span class="token string">'react-dom'</span><span class="token punctuation">,</span>
        replacement<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../packages/react-dom'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>重新启动项目，可以看到控制台成功打印了 <code>render</code> 字符串。至此，我们项目的基本目录结构就完成了。</p> <h2 id="引入-eslint、prettier"><a href="#引入-eslint、prettier" class="header-anchor">#</a> 引入 eslint、prettier</h2> <p>关于 <code>eslint</code> 和 <code>prettier</code> 的配置，这里就不过多介绍了，可以参考 <a href="/BlogSite/vite/base/vite-lint/">lint 配置</a>。</p> <p>至此，我们项目的开发环境就算完成了，接下来我们将完成 JSX 的转换。</p> <p>本节代码： <a href="https://github.com/dpp050700/mini-react/tree/react18-v1" target="_blank" rel="noopener noreferrer"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/BlogSite/react/analysis/" class="prev">
        React 原理分析
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/BlogSite/assets/js/app.93347ae9.js" defer></script><script src="/BlogSite/assets/js/2.1c2fd4e3.js" defer></script><script src="/BlogSite/assets/js/5.78d91289.js" defer></script>
  </body>
</html>
